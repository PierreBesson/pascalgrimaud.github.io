<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Paris JHipster Meetup #3</title>
		<meta name="description" content="Paris JHipster Meetup #3">
		<meta name="author" content="Pascal Grimaud">
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/white.css" id="theme">
		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">
		<!-- <link rel="stylesheet" href="styles/rainbow.css"> -->
		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>
	<body>
		<div class="reveal">
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<!------------------------------------------------------------->
				<!-- page d'attente -->
				<section>
					<h1>Paris JHipster Meetup #3</h1>
					<img data-src="./images/logo-jhipster-drink-coffee.png" alt="">
				</section>

				<!------------------------------------------------------------->
				<!-- présentation -->
				<section>
					<br/><br/>
					<h2>Pascal GRIMAUD</h2>
					<p>Java EE Consultant</p>
					<p>Docker enthusiast</p>
					<br/>
					<p>Contact:<br/>
					<p>
						<a href="https://www.linkedin.com/in/pascalgrimaud" target="_blank" title="linkedin">
							<img height="48px" data-src="./images/linkedin.png" alt="">
						</a>
						<a href="http://www.viadeo.com/fr/profile/pascal.grimaud" target="_blank" title="viadeo">
							<img height="48px" data-src="./images/viadeo.jpg" alt="">
						</a>
						<a href="https://twitter.com/pascalgrimaud" target="_blank" title="twitter">
							<img height="48px" data-src="./images/twitter.jpg" alt="">
						</a>
						<a href="https://github.com/pascalgrimaud/" target="_blank" title="github">
							<img height="48px" data-src="./images/github.png" alt="">
						</a>
					</p>
				</section>

				<!------------------------------------------------------------->
				<!-- titre du meetup -->
				<section>
					<h1>JHipster & Docker</h1>
					<img height="180px" data-src="./images/logo-jhipster2x.png" alt=""><img data-src="./images/docker-birthday.png" alt="">
				</section>

				<!------------------------------------------------------------->
				<!-- Sommaire -->
				<section>
					<h2>How Docker is used ?</h2>
					<ul>
						<li>JHipster installation with Docker</li>
						<li>Services generator</li>
						<li>JHipster Organization at Docker Hub</li>
						<li>Microservices</li>
					</ul>
				</section>

				<!------------------------------------------------------------->
				<section>
					<section>
						<h2>Docker Engine</h2>
						<img width="50%" height="50%" data-src="./images/docker.png" alt="Docker Engine">
					</section>
					<section>
						<h4>Installations</h2>
						<ul>
							<li>Local installation</li>
							<li>Vagrant box: <a href="https://github.com/jhipster/jhipster-devbox" target="_blank">devbox</a></li>
							<li>Docker installation</li>
						</ul>
					</section>
					<section>
						<h4>Docker installation<br/>Based on ubuntu:trusty</h4>
						<p><img width="10%" height="10%" data-src="./images/ubuntu.png" alt="ubuntu"></p>
						<ul>
							<li>Image:
								<a href="https://hub.docker.com/r/jhipster/jhipster/" target="_blank">jhipster/jhipster</a>
							</li>
							<li>generator-jhipster:
								<a href="https://github.com/jhipster/generator-jhipster/blob/master/Dockerfile" target="_blank">Dockerfile</a>
							</li>
							<ul>
								<li>git</li>
								<li>java 8</li>
								<li>node 4 + npm</li>
								<li>yeoman, bower, gulp</li>
								<li>wget, curl, vim, etc.</li>
							</ul>
						</ul>
					</section>
					<section>
						<h4>How to install</h4>
						<pre><code>docker pull jhipster/jhipster</code></pre>
						<p>
							put archi here...
						</p>
					</section>
					<section data-markdown>
						<script type="text/template">
							## Use cases

							Use JHipster v2.27.2
							```
							docker run --rm -it -v $(pwd):/home/jhipster/app \
							  -v ~/.m2:/home/jhipster/.m2 jhipster/jhipster:v2.27.2 yo jhipster
							```

							Use JHipster v3.0.0
							```
							docker run --rm -it -v $(pwd):/home/jhipster/app \
							  -v ~/.m2:/home/jhipster/.m2 jhipster/jhipster:v3.0.0 yo jhipster
							```

							Use JHipster master
							```
							docker run --rm -it -v $(pwd):/home/jhipster/app \
							  -v ~/.m2:/home/jhipster/.m2 jhipster/jhipster:master yo jhipster
							```
						</script>
					</section>
					<section data-markdown>
						<script type="text/template">
							## Demo (1/3)

							Create folder
							```
							mkdir jhipster && cd jhipster
							```

							Start a JHipster container
							```
							docker run --name jhipster \
							  -v $(pwd):/home/jhipster/app -v ~/.m2:/home/jhipster/.m2 \
							  -d -t jhipster/jhipster
							```

							Go into container
							```
							docker exec -it jhipster bash
							```
						</script>
					</section>
					<section>
						<h2>Demo (1/3)</h2>
						Create a JHipster project with Cassandra as database
						<pre><code data-trim>{
  "generator-jhipster": {
	"jhipsterVersion": "3.0.0",
	"baseName": "jhipster",
	"packageName": "com.mycompany.myapp",
	"packageFolder": "com/mycompany/myapp",
	"serverPort": "8080",
	"authenticationType": "session",
	"hibernateCache": "no",
	"clusteredHttpSession": "no",
	"websocket": "no",
	"databaseType": "cassandra",
	"devDatabaseType": "cassandra",
	"prodDatabaseType": "cassandra",
	"searchEngine": "no",
	"buildTool": "maven",
	"enableSocialSignIn": false,
	"rememberMeKey": "722f133a8480120ddc4436f084776036db6958b2",
	"useSass": false,
	"applicationType": "monolith",
	"testFrameworks": [
	  "gatling"
	],
	"enableTranslation": true,
	"nativeLanguage": "en",
	"languages": [
	  "en"
	]
  }
}</code></pre>
					</section>

				</section>

				<!------------------------------------------------------------->
				<section>
					<section>
						<h2>Docker Compose</h2>
						<img width="30%" data-src="./images/logo-title-final-compose-2b.png" alt="Docker Compose">
					</section>
					<section>
						<h4>After generating a JHipster project</h4>
						<ul>
							<li>Folder src/main/docker</li>
							<ul>
								<li>app.yml</li>
								<li>Dockerfile</li>
								<li>elasticsearch.yml</li>
								<li>mysql.yml</li>
								<li>sonar.yml</li>
							</ul>
						</ul>
					</section>
					<section data-markdown>
						<script type="text/template">
						mysql.yml
						```
						version: '2'
						services:
						    jhipster-mysql:
						        container_name: jhipster-mysql
						        image: mysql:5.7.11
						        # volumes:
						        #     - ~/volumes/jhipster/jhipster/mysql/:/var/lib/mysql/
						        environment:
						            - MYSQL_USER=root
						            - MYSQL_ALLOW_EMPTY_PASSWORD=yes
						            - MYSQL_DATABASE=jhipster
						        ports:
						            - 3306:3306
						        command: mysqld --lower_case_table_names=1
						```

						To start MySQL database:
						```
						docker-compose -f src/main/docker/mysql.yml up -d
						```
						</script>
					</section>
					<section data-markdown>
						<script type="text/template">
						## Demo (2/3)

						sonar.yml
						```
						version: '2'
						services:
						    jhipster-sonar:
						        container_name: jhipster-sonar
						        image: sonarqube:5.3
						        ports:
						            - 9000:9000
						            - 9092:9092
						```

						To start Sonar
						```
						docker-compose -f src/main/docker/sonar.yml up
						```

						To launch a Sonar Analyze
						```
						mvn sonar:sonar
						```
						</script>
					</section>
					<section>
						<h4>Thanks to Travis CI</h4>
						<img width="10%" height="10%" data-src="./images/travis-ci.png" alt="Travis CI">
						<br/>
						<p>
							<a href="https://travis-ci.org/jhipster/generator-jhipster" target="_blank">
								https://travis-ci.org/jhipster/generator-jhipster
							</a>
							<img data-src="./images/jhipster-travis.png" alt="JHipster Travis">
						</p>
					</section>
				</section>

				<!------------------------------------------------------------->
				<section>
					<section>
						<h2>Docker Hub</h2>
						<img data-src="./images/docker-hub.png" alt="Docker Hub">
					</section>
					<section>
						<h2>JHipster Organization</h2>
						<a href="https://hub.docker.com/r/jhipster/" target="_blank">https://hub.docker.com/r/jhipster/</a>
						<img data-src="./images/jhipster-organization.png" alt="Docker Hub">
					</section>
					<section>
						<h4>Next...</h4>
						<p>
						<img width="30%" height="30%" data-src="./images/logo-title-final-registry-2-907x1024.png" alt="Docker Hub">
						<img width="30%" height="30%" data-src="./images/logo-title-final-swarm-2d-219x300.png" alt="Docker Hub">
						</p>
					</section>
				</section>

				<!------------------------------------------------------------->
				<section>
					<section>
						<h1>Demo with</h1>
						<img data-src="./images/cassandra.png" alt="Cassandra">
					</section>
					<section>
						Create a simple entity: meetup
						<pre><code data-trim>{
    "relationships": [],
    "fields": [
        {
            "fieldName": "meetup",
            "fieldType": "String"
        },
        {
            "fieldName": "description",
            "fieldType": "String"
        }
    ],
    "changelogDate": "20160328225805",
    "dto": "no",
    "service": "no",
    "entityTableName": "meetup"
}</code></pre>
						Run the application in production profile
						<pre><code>mvn -Pprod</code></pre>
					</section>
					<section data-markdown>
						List folder:
						```
						ls -l src/main/docker
						```

						Build images:
						```
						docker-compose -f src/main/docker/cassandra-opscenter.yml build
						```

						Launch Cassandra and Opscenter:
						```
						docker-compose -f src/main/docker/cassandra-opscenter.yml up
						```

						Go to [http://localhost:8888](http://localhost:8888)
					</section>
					<section data-markdown>
						Check jhipster-cassandra (1st time):
						```
						docker exec -it jhipster-cassandra ls -l
						```
						```
						docker exec -it jhipster-cassandra cqlsh -k jhipster -e "select * from user;"
						```

						Check docker_jhipster-cassandra-node_1 (1st time):
						```
						docker exec -it docker_jhipster-cassandra-node_1 ls -l
						```
						```
						docker exec -it docker_jhipster-cassandra-node_1 cqlsh -k jhipster -e "select * from user;"
						```
					</section>
					<section data-markdown>
						Copy cql files:
						```
						docker cp src/main/ressources/config/cql jhipster-cassandra:/
						```

						Initialize the database with default schema:
						```
						docker exec -it jhipster-cassandra init
						```

						Create entities:
						```
						docker exec -it jhipster-cassandra entities
						```
					</section>
					<section data-markdown>
						Check jhipster-cassandra (2nd time):
						```
						docker exec -it jhipster-cassandra ls -l
						```
						```
						docker exec -it jhipster-cassandra cqlsh -k jhipster -e "select * from user;"
						```

						Check docker_jhipster-cassandra-node_1 (2nd time):
						```
						docker exec -it docker_jhipster-cassandra-node_1 ls -l
						```
						```
						docker exec -it docker_jhipster-cassandra-node_1 cqlsh -k jhipster -e "select * from user;"
						```
					</section>
					<section data-markdown>
						Add a new node:
						```
						docker-compose -f src/main/docker/cassandra-opscenter.yml \
						scale jhipster-cassandra-node=2
						```

						Add another node:
						```
						docker-compose -f src/main/docker/cassandra-opscenter.yml \
						scale jhipster-cassandra-node=3
						```

						Check docker container:
						```
						docker ps
						```

					</section>
					<section data-markdown>
						Get IPs of containers
						```
						docker inspect --format '{{ .NetworkSettings.Networks.docker_default.IPAddress }}' $(docker ps -q)
						```

						Start application in production profiles:
						```
						java -jar target/*.war --spring.data.cassandra.contact-points="172.20.0.3,172.20.0.4,172.20.0.5,172.20.0.6" --spring.profiles.active="prod"
						```
					</section>
				</section>

				<!-- fin -->
				<section>
		            <h1>
		                <small>Thank you</small>
		            </h1>
		            <img width="30%" height="30%" data-src="./images/to_be_continued.png" alt="to_be_continued">
		            <p>
		                <small><a href="https://github.com/hakimel/reveal.js" target="_blank">Reveal.js </a> - The HTML
		                    Presentation Framework
		                </small>
		            </p>
		        </section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});
		</script>
	</body>
</html>
